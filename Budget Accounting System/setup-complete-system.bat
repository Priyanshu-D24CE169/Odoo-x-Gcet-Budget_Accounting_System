@echo off
echo ????????????????????????????????????????????????????????????????????
echo ?         BUDGET ACCOUNTING SYSTEM - COMPLETE SETUP                ?
echo ?         Database + Login + Registration Ready!                   ?
echo ????????????????????????????????????????????????????????????????????
echo.
echo This script will:
echo  1. Create Identity database tables
echo  2. Setup login system
echo  3. Enable user registration
echo  4. Create default admin account
echo.
pause

echo.
echo ???????????????????????????????????????????????????????????????????
echo  STEP 1: Creating Migration for Identity System...
echo ???????????????????????????????????????????????????????????????????
dotnet ef migrations add AddIdentitySystemWithRegistration
if errorlevel 1 (
    echo ? ERROR: Migration creation failed!
    echo    Make sure you're in the correct directory.
    pause
    exit /b 1
)
echo ? Migration created successfully!
echo.

echo ???????????????????????????????????????????????????????????????????
echo  STEP 2: Applying Migration to Database...
echo ???????????????????????????????????????????????????????????????????
dotnet ef database update
if errorlevel 1 (
    echo ? ERROR: Database update failed!
    echo    Check your connection string in appsettings.json
    pause
    exit /b 1
)
echo ? Database updated successfully!
echo.

echo ???????????????????????????????????????????????????????????????????
echo  STEP 3: Building the Project...
echo ???????????????????????????????????????????????????????????????????
dotnet build
if errorlevel 1 (
    echo ? ERROR: Build failed!
    echo    Check for compilation errors.
    pause
    exit /b 1
)
echo ? Build completed successfully!
echo.

echo ????????????????????????????????????????????????????????????????????
echo ?                     SETUP COMPLETE! ?                            ?
echo ????????????????????????????????????????????????????????????????????
echo.
echo ????????????????????????????????????????????????????????????????????
echo ?  ?? DEFAULT ADMIN CREDENTIALS                                    ?
echo ????????????????????????????????????????????????????????????????????
echo ?                                                                   ?
echo ?  LoginID:  sysadmin                                              ?
echo ?  Password: Admin@1234                                            ?
echo ?  Email:    admin@shivfurniture.com                               ?
echo ?  Role:     Admin                                                 ?
echo ?                                                                   ?
echo ????????????????????????????????????????????????????????????????????
echo.
echo ????????????????????????????????????????????????????????????????????
echo ?  ?? HOW TO USE                                                   ?
echo ????????????????????????????????????????????????????????????????????
echo ?                                                                   ?
echo ?  1. Run: dotnet run                                              ?
echo ?  2. Navigate to: https://localhost:5001                          ?
echo ?  3. You'll see Login page with two options:                      ?
echo ?     • Sign In (existing users)                                   ?
echo ?     • Create New Account (new users)                             ?
echo ?                                                                   ?
echo ?  LOGIN:                                                          ?
echo ?    - Admin: sysadmin / Admin@1234                                ?
echo ?    - After login ? Purple Admin Dashboard                        ?
echo ?                                                                   ?
echo ?  SIGNUP/REGISTER:                                                ?
echo ?    - Click "Create New Account" button                           ?
echo ?    - Fill in registration form:                                  ?
echo ?      • Choose role (Admin or Portal User)                        ?
echo ?      • Enter first name, last name                               ?
echo ?      • Create login ID (6-12 chars)                              ?
echo ?      • Enter email                                               ?
echo ?      • Create password (8+ chars, mixed case, special char)      ?
echo ?      • Optionally link to existing contact                       ?
echo ?    - Click "Create Account"                                      ?
echo ?    - Auto-login and redirect to appropriate dashboard            ?
echo ?                                                                   ?
echo ?  ROLE-BASED REDIRECTION:                                         ?
echo ?    - Admin ? /Admin/Dashboard (Purple)                           ?
echo ?    - Portal User ? /Portal/Dashboard (Green)                     ?
echo ?                                                                   ?
echo ????????????????????????????????????????????????????????????????????
echo.
echo ????????????????????????????????????????????????????????????????????
echo ?  ?? START THE APPLICATION NOW                                    ?
echo ????????????????????????????????????????????????????????????????????
echo ?                                                                   ?
echo ?  Command: dotnet run                                             ?
echo ?                                                                   ?
echo ?  OR press F5 in Visual Studio                                    ?
echo ?                                                                   ?
echo ????????????????????????????????????????????????????????????????????
echo.
pause
